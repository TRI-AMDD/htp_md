name: testing - main

on:
  # pull_request:
  #   branches:
  #     - main
  push:
    branches:
      - paper_improv #main

jobs:
  test:
    strategy:
      max-parallel: 20
      matrix:
        os: [ubuntu-20.04, macos-latest, windows-latest]
        python-version: [3.7]

    runs-on: ${{ matrix.os}}

    steps: 
    - name: Checkout
      uses: actions/checkout@v2

    - name: Extract branch name
      shell: bash
      run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/} | tr '[:upper:]' '[:lower:]' | tr '[:punct:]' '_')"
      id: extract_branch

    - name: Set up Python ${{matrix.python-version}}
      uses: actions/setup-python@v2
      with:
        python-version: ${{matrix.python-version}}

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install wheel
        pip install torch==1.8.1
        pip install -r requirements.txt
        pip install -e .[tests]

    # - name: pytest
    #   run: |
    #     pytest htpmd --color=yes --cov=htpmd --cov-config=.coveragec --cov-report html:coverage_reports

    # - name: Coveralls
    #   run: |
    #     coveralls --service=github

    